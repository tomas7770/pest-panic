-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua

function BOOT()
	DT = 1/60
	gameSpeed = 1
	plrMoveAnim = {
		x = {
			-- Sum must be 24
			3,
			3,
			3,
			3,

			3,
			3,
			3,
			3,
		},
		y = {
			-- Sum must be 0
			-3,
			-3,
			-3,
			-3,

			3,
			3,
			3,
			3,
		},
	}
	plrClimbAnim = {
		-- Sum must be 24
		3,
		3,
		3,
		3,

		3,
		3,
		3,
		3,
	}
	plrDropAnim = {
		-- Sum must be 24
		-3,
		-2,
		-1,

		3,
		6,
		9,
		12,
	}
	plr = {
		x = 0,
		y = 0,
		gx = 2,
		gy = 4,
		moveDir = 1,
		moveAnimTimer = 0,
		moveAnimTimerMax = 0.03,
		moveAnimIndex = 0,
		climbDir = 1,
		climbAnimIndex = 0,
		moving = function(self)
			return self.moveAnimIndex ~= 0
		end,
		climbing = function(self)
			return self.climbAnimIndex ~= 0
		end,
		canMoveLeft = function(self)
			if self.gy == 4 then
				return self.gx > 1
			else
				return self.gx > 4
			end
		end,
		canMoveRight = function(self)
			return self.gx < 8
		end,
	}
	plr.x, plr.y = addSprOffset(gameTilePos(plr.gx, plr.gy))
end

function gameTilePos(x,y)
	-- 10x5(.5)
	return x*24, y*24
end

function addSprOffset(x,y)
	-- Draw 16x16 centered on 24x24
	return x+4, y+4
end

function TIC()
	if not plr:moving() and not plr:climbing() then
		if btn(2) and plr:canMoveLeft() then
			plr.gx = plr.gx-1
	
			plr.moveDir = -1
			plr.moveAnimTimer = plr.moveAnimTimerMax
			plr.moveAnimIndex = 1
		elseif btn(3) and plr:canMoveRight() then
			plr.gx = plr.gx+1
	
			plr.moveDir = 1
			plr.moveAnimTimer = plr.moveAnimTimerMax
			plr.moveAnimIndex = 1
		elseif plr.gx == 4 or plr.gx == 8 then
			if btn(0) and plr.gy > 2 then
				plr.gy = plr.gy-1

				plr.climbDir = -1
				plr.moveAnimTimer = plr.moveAnimTimerMax
				plr.climbAnimIndex = 1
			elseif btn(1) and plr.gy < 4 then
				plr.gy = plr.gy+1

				plr.climbDir = 1
				plr.moveAnimTimer = plr.moveAnimTimerMax
				plr.climbAnimIndex = 1
			end
		elseif plr.gx > 4 and plr.gx < 8 and btn(1) and plr.gy < 4 then
			-- Drop down
			plr.gy = plr.gy+1

			plr.climbDir = 0
			plr.moveAnimTimer = plr.moveAnimTimerMax
			plr.climbAnimIndex = 1
		end
	end
	if plr.moveAnimIndex ~= 0 then
		plr.moveAnimTimer = plr.moveAnimTimer-DT*gameSpeed
		while plr.moveAnimTimer < 0 do
			plr.x = plr.x+plrMoveAnim.x[plr.moveAnimIndex]*plr.moveDir
			plr.y = plr.y+plrMoveAnim.y[plr.moveAnimIndex]
			if plr.moveAnimIndex == #plrMoveAnim.x then
				plr.moveAnimIndex = 0
				break
			end
			plr.moveAnimIndex = plr.moveAnimIndex+1
			plr.moveAnimTimer = plr.moveAnimTimer + plr.moveAnimTimerMax
		end
	elseif plr.climbAnimIndex ~= 0 then
		plr.moveAnimTimer = plr.moveAnimTimer-DT*gameSpeed
		while plr.moveAnimTimer < 0 do
			local animTable
			if plr.climbDir == 0 then
				animTable = plrDropAnim
				plr.y = plr.y+animTable[plr.climbAnimIndex]
			else
				animTable = plrClimbAnim
				plr.y = plr.y+animTable[plr.climbAnimIndex]*plr.climbDir
			end
			if plr.climbAnimIndex == #animTable then
				plr.climbAnimIndex = 0
				break
			end
			plr.climbAnimIndex = plr.climbAnimIndex+1
			plr.moveAnimTimer = plr.moveAnimTimer + plr.moveAnimTimerMax
		end
	end

	cls(0)
	map(0,0,30,17,0,0)
	spr(257, plr.x, plr.y, 0, 1, plr.moveDir == -1 and 1 or 0, 0, 2, 2)
end

-- <TILES>
-- 001:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 002:aaa1111aaaa1111aaaa1111aaaa1111aaaa11111aaa11111aaa11111aaa11111
-- 003:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa11111111111111111111111111111111
-- 004:aa1111aaaa1111aaaa1111aaaa1111aa111111aa111111aa111111aa111111aa
-- 005:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 006:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa55aaaaa5555aaa333333aa333333aa
-- 007:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 018:aaa1111aaaa1111aaaa1111aaaa1111aaaa1111aaaa1111aaaa1111aaaa11111
-- 019:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa11111111
-- 020:aa1111aaaa1111aaaa1111aaaa1111aaaa1111aaaa1111aaaa1111aa111111aa
-- 021:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 022:a3333aaaa3333aaaa3333aaaaa333aaaaa333aaaaa33aaaaaa33aaaaaa33aaaa
-- 023:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 034:aaa11111aaa11111aaa11111aaa1111aaaa1111aaaa1111aaaa1111aaaa1111a
-- 035:111111111111111111111111aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 036:111111aa111111aa111111aaaa1111aaaa1111aaaa1111aaaa1111aaaa1111aa
-- 037:222222222222222222222222aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 038:222222222222222222222222aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 039:222222222222222222222222aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- </TILES>

-- <SPRITES>
-- 001:0000000000000000000000000000000000000000000000cc0ccc0ccccccccccc
-- 002:000cc00000ccc0000cccc0000ccc20000ccc2c00ccccccc0cccccccccccccccc
-- 003:0dd0000d00d0000d00ddd00d0000dddd00000dcc000000cc00000dd00000dd00
-- 004:d000000000000000000000000000000000000000dd000000ddd000000ddd0000
-- 017:cccccccc0ccccccc000ccccc000ccccc000ccccc000ccccc00cccc0000ccc000
-- 018:cccc0000ccc00000ccc00000ccc00000cccc0000cccc0000ccccc000ccccc000
-- 019:0000d0000000d000000eeee0000e00e0000e00e0000e0ee0000eee0000000000
-- 020:000de000000eeee0000e00e0000e00e0000e00e00000ee000000000000000000
-- </SPRITES>

-- <MAP>
-- 000:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:101010101010101010101010203040506070506070506070203040101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:101010101010101010101010213141516171516171516171213141101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:101010101010101010101010223242526272526272526272223242101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:101010101010101010101010203040506070506070506070203040101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:101010101010101010101010213141516171516171516171213141101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:101010101010101010101010223242526272526272526272223242101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:101010101010101010101010203040101010101010101010203040101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:101010101010101010101010213141101010101010101010213141101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:101010101010101010101010223242101010101010101010223242101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

